!function(){"use strict";function e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class t{constructor(t,r,s){e(this,"_pressLike",(e=>{e.target.classList.toggle("card__like_active")})),e(this,"_pressDelete",(()=>{this._element.remove(),this._element=null})),this._data=t,this._title=t.title,this._link=t.link,this._cardSelector=r,this._handleCardClick=s}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".grid__card").cloneNode(!0)}generateCard(){this._element=this._getTemplate(),this._setEventListeners();const e=this._element.querySelector(".card__image"),t=this._element.querySelector(".card__title");return e.style.backgroundImage="url(".concat(this._link,")"),t.textContent=this._title,this._element}_setEventListeners(){this._element.querySelector(".card__like").addEventListener("click",this._pressLike),this._element.querySelector(".card__delete").addEventListener("click",this._pressDelete),this._element.querySelector(".card__image").addEventListener("click",(()=>{this._handleCardClick()}))}}function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=class{constructor(e,t){r(this,"_showInputError",((e,t)=>{const r=this._element.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),r.textContent=t,r.classList.add(this._errorClass)})),r(this,"_hideInputError",(e=>{const t=this._element.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.classList.remove(this._inputErrorClass),t.textContent=""})),r(this,"_checkInputValidity",(e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)})),r(this,"_toggleButtonState",(()=>{this._hasInvalidInput(this._inputList)?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1)})),this._inputSelector=e.inputSelector,this._fieldsetSelector=e.fieldsetSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._element=t,this._inputList=Array.from(t.querySelectorAll(this._inputSelector)),this._buttonElement=t.querySelector(this._submitButtonSelector)}resetValidationError(){this._inputList.forEach((e=>{this._hideInputError(e)})),this._toggleButtonState()}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_setEventListeners(){this._element.addEventListener("submit",(function(e){e.preventDefault()})),this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._element.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners()}};class n{constructor(e){var t,r;r=e=>{e.target===e.currentTarget&&this.close(e.target)},(t="_handleLayoverClose")in this?Object.defineProperty(this,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[t]=r,this._popupElement=e,this._handleEscClose=this._handleEscClose.bind(this),this._handleLayoverClose=this._handleLayoverClose.bind(this)}_handleEscClose(e){"Escape"===e.key&&this.close()}open(){this._popupElement.classList.add("popup_enabled"),document.addEventListener("keydown",this._handleEscClose),this._popupElement.addEventListener("mousedown",this._handleLayoverClose)}close(){this._popupElement.classList.remove("popup_enabled"),document.removeEventListener("keydown",this._handleEscClose),this._popupElement.removeEventListener("mousedown",this._handleLayoverClose)}setEventListeners(){this._popupElement.addEventListener("click",(e=>{e.target.classList.contains("popup__close")&&this.close()}))}}class i extends n{constructor(e,t){super(e),this._handleFormSubmit=t,this._formElement=this._popupElement.querySelector(".popup__form"),this._inputList=this._formElement.querySelectorAll(".form__input")}_getInputValues(){const e={};return this._inputList.forEach((t=>{const r=t.id,s=t.value;e[r]=s})),e}setEventListeners(){super.setEventListeners(),this._formElement.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}setInputValues(e){this._inputs.forEach((t=>{t.value=e[t.name]}))}close(){super.close(),this._formElement.reset()}}const o=(e,t)=>fetch(e,t).then((e=>e.ok?e.json():Promise.reject("Something went wrong: ".concat(e.status))));document.querySelector(".profile__name"),document.querySelector(".profile__category");const l=document.querySelector(".profile__picture"),a=document.querySelector(".image"),c=(document.getElementById("title"),document.getElementById("link"),document.querySelector(".grid__cards"),document.querySelector(".profile__edit-button")),u=(document.querySelector(".edit__close"),document.querySelector(".edit")),d=(document.getElementById("editForm"),document.querySelector(".avatar")),_=document.querySelector("#edit"),h=document.querySelector("#add"),m=document.querySelector("#avatar"),p=document.getElementById("name"),E=document.getElementById("category"),v=document.getElementById("avatar"),f=document.querySelector(".profile__add-button"),y=(document.querySelector(".add__close"),document.querySelector(".add")),g=(document.getElementById("addForm"),document.querySelector(".form__button"),{formSelector:".form",inputSelector:".form__input",fieldsetSelector:".form__fieldset",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"}),S=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}getInitialCards(){return o("".concat(this._baseUrl,"/cards"),{headers:this._headers})}addCard(e){return o("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e.title,link:e.link})})}getUserInfo(){return o("".concat(this._baseUrl,"/users/me"),{headers:this._headers})}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"b451294b-44d9-464a-8874-2d4137a4eb3c","Content-Type":"application/json"}});let b;Promise.all([S.getUserInfo(),S.getInitialCards()]).then((e=>{let[t,r]=e;b=r.id,w.setUserInfo(r.name,r.about),w.setUserImage(r.avatar),L.renderItems(t)})).catch((e=>{console.log(e)}));const L=new class{constructor(e,t){let{renderer:r}=e;this._renderer=r,this._container=document.querySelector(t)}addItem(e){const t=this._renderer(e);this._container.prepend(t)}renderItems(e){e.forEach((e=>{this.addItem(e)}))}}({renderer:function(e){return new t(e,"#card",(()=>{q.open(e.title,e.link)})).generateCard()}},".grid__cards");L.renderItems();const C=new i(_,(e=>{w.setUserInfo(e.name,e.description),C.close()}));C.setEventListeners();const I=new i(h,(e=>{const t={title:e.title,link:e.link};L.addItem(t),I.close()}));I.setEventListeners();const q=new class extends n{constructor(e){super(e),this._imageTitle=this._popupElement.querySelector(".image__title"),this._imagePreview=this._popupElement.querySelector(".image__file")}open(e,t){super.open(),this._imagePreview.src=t,this._imagePreview.alt=e,this._imageTitle.textContent=e}}(a);q.setEventListeners();const k=new i(m,(e=>{w.setUserImage(e.picture),k.close()}));k.setEventListeners();const w=new class{constructor(e){let{fullName:t,category:r,profilePic:s}=e;this._fullName=document.querySelector(t),this._category=document.querySelector(r),this._profilePic=document.querySelector(s)}getUserInfo(){return{name:this._fullName.textContent,description:this._category.textContent,picture:this._profilePic.src}}setUserInfo(e,t){this._fullName.textContent=e,this._category.textContent=t}setUserImage(e){this._profilePic.src=e}}({fullName:".profile__name",category:".profile__category",profilePic:".profile__picture"});c.addEventListener("click",(function(){const e=w.getUserInfo();p.value=e.name,E.value=e.description,B.resetValidationError(),C.open()})),f.addEventListener("click",(()=>{U.resetValidationError(),I.open()})),l.addEventListener("click",(function(){const e=w.getUserInfo();v.value=e.picture,P.resetValidationError(),k.open()}));const B=new s(g,u),U=new s(g,y),P=new s(g,d);B.enableValidation(),U.enableValidation(),P.enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Vy9FLGlCQUFpQixTQWxCNUIsV0FDRSxNQUFNb0osRUFBVXBDLEVBQVNOLGNBQ3pCaEIsRUFBWTVCLE1BQVFzRixFQUFRTixRQUU1QlMsRUFBb0JySCx1QkFDcEIyRyxFQUFXM0YsVUFrQmIsTUFBTW1HLEVBQW9CLElBQUlHLEVBQWMzRCxFQUFZVixHQUNsRG1FLEVBQW1CLElBQUlFLEVBQWMzRCxFQUFZRCxHQUNqRDJELEVBQXNCLElBQUlDLEVBQWMzRCxFQUFZVCxHQUUxRGlFLEVBQWtCN0csbUJBQ2xCOEcsRUFBaUI5RyxtQkFDakIrRyxFQUFvQi9HLG1CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3Byb2plY3RfNC8uL3NyYy9zY3JpcHRzL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0cy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3Byb2plY3RfNC8uL3NyYy9zY3JpcHRzL2NvbXBvbmVudHMvUG9wdXBGb3JtLmpzIiwid2VicGFjazovL3Byb2plY3RfNC8uL3NyYy9zY3JpcHRzL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL3Byb2plY3RfNC8uL3NyYy9zY3JpcHRzL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly9wcm9qZWN0XzQvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3Byb2plY3RfNC8uL3NyYy9zY3JpcHRzL2NvbXBvbmVudHMvUG9wdXBJbWFnZS5qcyIsIndlYnBhY2s6Ly9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0cy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlxyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBDYXJkIHtcclxuICBjb25zdHJ1Y3RvcihkYXRhLCBjYXJkU2VsZWN0b3IsIGhhbmRsZUNhcmRDbGljaykge1xyXG4gICAgdGhpcy5fZGF0YSA9IGRhdGE7XHJcbiAgICB0aGlzLl90aXRsZSA9IGRhdGEudGl0bGU7XHJcbiAgICB0aGlzLl9saW5rID0gZGF0YS5saW5rO1xyXG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xyXG5cclxuICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayA9IGhhbmRsZUNhcmRDbGljaztcclxuICB9XHJcblxyXG4gIF9nZXRUZW1wbGF0ZSgpIHtcclxuICAgIGNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcclxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5ncmlkX19jYXJkXCIpO1xyXG4gICAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpO1xyXG5cclxuICAgIHJldHVybiBjYXJkRWxlbWVudDtcclxuICB9XHJcblxyXG4gIGdlbmVyYXRlQ2FyZCgpIHtcclxuICAgIHRoaXMuX2VsZW1lbnQgPSB0aGlzLl9nZXRUZW1wbGF0ZSgpO1xyXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbiAgICBjb25zdCBjYXJkSW1hZ2UgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XHJcbiAgICBjb25zdCBjYXJkVGl0bGUgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XHJcblxyXG4gICAgY2FyZEltYWdlLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IGB1cmwoJHt0aGlzLl9saW5rfSlgO1xyXG4gICAgY2FyZFRpdGxlLnRleHRDb250ZW50ID0gdGhpcy5fdGl0bGU7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAvL2xpa2UgaGFuZGxlclxyXG4gICAgY29uc3QgY2FyZExpa2UgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZVwiKTtcclxuICAgIGNhcmRMaWtlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9wcmVzc0xpa2UpO1xyXG5cclxuICAgIC8vZGVsZXRlIGhhbmRsZXJcclxuICAgIGNvbnN0IGNhcmREZWxldGUgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlXCIpO1xyXG4gICAgY2FyZERlbGV0ZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5fcHJlc3NEZWxldGUpO1xyXG4gICAgY29uc3QgY2FyZEltYWdlID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xyXG4gICAgY2FyZEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljaygpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvL19oYW5kbGVDYXJkQ2xpY2sgPSAoKSA9PiB7XHJcbiAgIC8vIHRoaXMuUG9wdXBJbWFnZVxyXG4gLy8gfVxyXG5cclxuICBfcHJlc3NMaWtlID0gKGV2dCkgPT4ge1xyXG4gICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZV9hY3RpdmVcIik7XHJcbiAgfTtcclxuXHJcbiAgX3ByZXNzRGVsZXRlID0gKCkgPT4ge1xyXG4gICAgdGhpcy5fZWxlbWVudC5yZW1vdmUoKTtcclxuICAgIHRoaXMuX2VsZW1lbnQgPSBudWxsO1xyXG4gIH07XHJcbn0iLCJjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuICBjb25zdHJ1Y3Rvcihjb25maWcsIGZvcm1FbGVtZW50KSB7XHJcbiAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gY29uZmlnLmlucHV0U2VsZWN0b3I7XHJcbiAgICB0aGlzLl9maWVsZHNldFNlbGVjdG9yID0gY29uZmlnLmZpZWxkc2V0U2VsZWN0b3I7XHJcbiAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvciA9IGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3RvcjtcclxuICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSBjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcztcclxuICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IGNvbmZpZy5pbnB1dEVycm9yQ2xhc3M7XHJcbiAgICB0aGlzLl9lcnJvckNsYXNzID0gY29uZmlnLmVycm9yQ2xhc3M7XHJcblxyXG4gICAgdGhpcy5fZWxlbWVudCA9IGZvcm1FbGVtZW50O1xyXG4gICAgdGhpcy5faW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcclxuICAgICAgZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKVxyXG4gICAgKTtcclxuICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIF9zaG93SW5wdXRFcnJvciA9IChpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSkgPT4ge1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICBgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcclxuICAgICk7XHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgfTtcclxuXHJcbiAgX2hpZGVJbnB1dEVycm9yID0gKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICBgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcclxuICAgICk7XHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcclxuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgfTtcclxuXHJcbiAgcmVzZXRWYWxpZGF0aW9uRXJyb3IoKSB7XHJcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG4gIH1cclxuXHJcbiAgX2NoZWNrSW5wdXRWYWxpZGl0eSA9IChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgX2hhc0ludmFsaWRJbnB1dCgpIHtcclxuICAgIHJldHVybiB0aGlzLl9pbnB1dExpc3Quc29tZSgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfdG9nZ2xlQnV0dG9uU3RhdGUgPSAoKSA9PiB7XHJcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KHRoaXMuX2lucHV0TGlzdCkpIHtcclxuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgICB0aGlzLl9idXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG5cclxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZnVuY3Rpb24gKGV2dCkge1xyXG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBGb3JtVmFsaWRhdG9yOyIsImV4cG9ydCBjbGFzcyBQb3B1cHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cEVsZW1lbnQpe1xyXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50ID0gcG9wdXBFbGVtZW50O1xyXG4gICAgdGhpcy5faGFuZGxlRXNjQ2xvc2UgPSB0aGlzLl9oYW5kbGVFc2NDbG9zZS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5faGFuZGxlTGF5b3ZlckNsb3NlID0gdGhpcy5faGFuZGxlTGF5b3ZlckNsb3NlLmJpbmQodGhpcyk7XHJcbiAgfVxyXG5cclxuICBfaGFuZGxlRXNjQ2xvc2UoZXZ0KSB7XHJcbiAgICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICB0aGlzLmNsb3NlKClcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9oYW5kbGVMYXlvdmVyQ2xvc2UgPSAoZXZ0KSA9PiB7XHJcbiAgICBpZiAoZXZ0LnRhcmdldCA9PT0gZXZ0LmN1cnJlbnRUYXJnZXQpIHtcclxuICAgICAgdGhpcy5jbG9zZShldnQudGFyZ2V0KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBvcGVuKCkge1xyXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9lbmFibGVkXCIpO1xyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5faGFuZGxlTGF5b3ZlckNsb3NlKTtcclxuICB9XHJcblxyXG4gIGNsb3NlKCkge1xyXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9lbmFibGVkXCIpO1xyXG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5faGFuZGxlTGF5b3ZlckNsb3NlKTtcclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XHJcbiAgICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX19jbG9zZVwiKSkge1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgIH0pO1xyXG5cclxuXHJcbn1cclxufSIsImltcG9ydCB7IFBvcHVwIH0gZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBQb3B1cEZvcm0gZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBFbGVtZW50LCBoYW5kbGVGb3JtU3VibWl0KSB7XHJcbiAgICBzdXBlcihwb3B1cEVsZW1lbnQpO1xyXG5cclxuXHJcbiAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcclxuICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1cIik7XHJcbiAgICB0aGlzLl9pbnB1dExpc3QgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmZvcm1fX2lucHV0XCIpO1xyXG4gIH1cclxuXHJcbiAgX2dldElucHV0VmFsdWVzKCkge1xyXG4gICAgY29uc3QgaW5wdXRzID0ge307XHJcblxyXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XHJcbiAgICAgIGNvbnN0IGtleSA9IGlucHV0LmlkO1xyXG4gICAgICBjb25zdCB2YWx1ZSA9IGlucHV0LnZhbHVlO1xyXG4gICAgICBpbnB1dHNba2V5XSA9IHZhbHVlO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gaW5wdXRzO1xyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4ge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KHRoaXMuX2dldElucHV0VmFsdWVzKCkpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzZXRJbnB1dFZhbHVlcyhkYXRhKSB7XHJcbiAgICB0aGlzLl9pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcclxuICAgICAgaW5wdXQudmFsdWUgPSBkYXRhW2lucHV0Lm5hbWVdO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBjbG9zZSgpIHtcclxuICAgIHN1cGVyLmNsb3NlKClcclxuICAgIHRoaXMuX2Zvcm1FbGVtZW50LnJlc2V0KClcclxufVxyXG5cclxufSIsImNvbnN0IGZldGNoZXIgPSAodXJsLCBoZWFkZXIpID0+IFxyXG4gICAgZmV0Y2godXJsLCBoZWFkZXIpLnRoZW4oKHJlcykgPT5cclxuICAgIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChgU29tZXRoaW5nIHdlbnQgd3Jvbmc6ICR7cmVzLnN0YXR1c31gKVxyXG4gICAgICApOyBcclxuXHJcbiAgZXhwb3J0IGNsYXNzIEFwaSB7XHJcbiAgICBjb25zdHJ1Y3Rvcih7YmFzZVVybCwgaGVhZGVyc30pe1xyXG4gICAgICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xyXG4gICAgfTtcclxuICAgIGdldEluaXRpYWxDYXJkcygpe1xyXG4gICAgICAgIHJldHVybiBmZXRjaGVyKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuICAgIGFkZENhcmQoZGF0YSl7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoZXIgKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiBkYXRhLnRpdGxlLFxyXG4gICAgICAgICAgICAgICAgbGluazogZGF0YS5saW5rXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBnZXRVc2VySW5mbygpe1xyXG4gICAgICAgIHJldHVybiBmZXRjaGVyKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcbiIsIi8vaW5pdGlhbCBpbWFnZXNcclxuXHJcbmV4cG9ydCBjb25zdCBpbml0aWFsQ2FyZHMgPSBbXHJcbiAgICB7XHJcbiAgICAgIHRpdGxlOiBcIllvc2VtaXRlIFZhbGxleVwiLFxyXG4gICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3lvc2VtaXRlLmpwZ1wiLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgdGl0bGU6IFwiTGFrZSBMb3Vpc2VcIixcclxuICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYWtlLWxvdWlzZS5qcGdcIixcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIHRpdGxlOiBcIkJhbGQgTW91bnRhaW5zXCIsXHJcbiAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvYmFsZC1tb3VudGFpbnMuanBnXCIsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICB0aXRsZTogXCJMYXRlbWFyXCIsXHJcbiAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGF0ZW1hci5qcGdcIixcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIHRpdGxlOiBcIlZhbm9pc2UgTmF0aW9uYWwgUGFya1wiLFxyXG4gICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3Zhbm9pc2UuanBnXCIsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICB0aXRsZTogXCJMYWdvIGRpIEJyYWllc1wiLFxyXG4gICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xhZ28uanBnXCIsXHJcbiAgICB9LFxyXG4gIF07XHJcbiAgXHJcbi8vcHJvZmlsZSBjb25zdHNcclxuXHJcbmV4cG9ydCBjb25zdCBmdWxsTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcclxuZXhwb3J0IGNvbnN0IGNhdGVnb3J5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19jYXRlZ29yeVwiKTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVQaWMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX3BpY3R1cmVcIik7XHJcblxyXG4vL2ltYWdlIGNvbnN0c1xyXG5leHBvcnQgY29uc3QgcG9wdXBJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaW1hZ2VcIik7XHJcbmV4cG9ydCBjb25zdCB0aXRsZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0aXRsZVwiKTtcclxuZXhwb3J0IGNvbnN0IGxpbmtJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibGlua1wiKTtcclxuXHJcblxyXG5leHBvcnQgY29uc3QgY2FyZEdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdyaWRfX2NhcmRzXCIpO1xyXG5cclxuLy9wcm9maWxlIGZvcm0gY29uc3RzXHJcblxyXG5leHBvcnQgY29uc3QgYnV0dG9uRWRpdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idXR0b25cIik7XHJcbmV4cG9ydCBjb25zdCBjbG9zZUVkaXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVkaXRfX2Nsb3NlXCIpO1xyXG5leHBvcnQgY29uc3QgZm9ybUVkaXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVkaXRcIik7XHJcbmV4cG9ydCBjb25zdCBlZGl0Rm9ybUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImVkaXRGb3JtXCIpO1xyXG5cclxuLy9hdmF0YXIgZm9ybSBjb25zdHNcclxuXHJcbmV4cG9ydCBjb25zdCBmb3JtQXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5hdmF0YXJcIik7XHJcblxyXG5cclxuLy9wb3B1cCBmb3JtIGNvbnN0c1xyXG5cclxuZXhwb3J0IGNvbnN0IGVkaXRQb3B1cEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZWRpdCcpO1xyXG5leHBvcnQgY29uc3QgYWRkUG9wdXBFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2FkZCcpO1xyXG5leHBvcnQgY29uc3QgYXZhdGFyUG9wdXBFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2F2YXRhcicpO1xyXG5cclxuXHJcbi8vaW5wdXRzXHJcbmV4cG9ydCBjb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm5hbWVcIik7XHJcbmV4cG9ydCBjb25zdCBqb2JJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2F0ZWdvcnlcIik7XHJcbmV4cG9ydCBjb25zdCBhdmF0YXJJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYXZhdGFyXCIpO1xyXG5cclxuLy8gaW1hZ2UgZm9ybSBjb25zdHNcclxuZXhwb3J0IGNvbnN0IGJ1dHRvbkFkZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcclxuZXhwb3J0IGNvbnN0IGNsb3NlQWRkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5hZGRfX2Nsb3NlXCIpO1xyXG5leHBvcnQgY29uc3QgZm9ybUFkZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYWRkXCIpO1xyXG5leHBvcnQgY29uc3QgYWRkRm9ybUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFkZEZvcm1cIik7XHJcbmV4cG9ydCBjb25zdCBidXR0b25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5mb3JtX19idXR0b25cIik7XHJcblxyXG4vL3ZhbGlkYXRpb24gY29uc3RzXHJcblxyXG5leHBvcnQgY29uc3QgZm9ybUNvbmZpZyA9IHtcclxuICAgIGZvcm1TZWxlY3RvcjogXCIuZm9ybVwiLFxyXG4gICAgaW5wdXRTZWxlY3RvcjogXCIuZm9ybV9faW5wdXRcIixcclxuICAgIGZpZWxkc2V0U2VsZWN0b3I6IFwiLmZvcm1fX2ZpZWxkc2V0XCIsXHJcbiAgICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIuZm9ybV9fYnV0dG9uXCIsXHJcbiAgICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcImZvcm1fX2J1dHRvbl9pbmFjdGl2ZVwiLFxyXG4gICAgaW5wdXRFcnJvckNsYXNzOiBcImZvcm1fX2lucHV0X3R5cGVfZXJyb3JcIixcclxuICAgIGVycm9yQ2xhc3M6IFwiZm9ybV9faW5wdXQtZXJyb3JfYWN0aXZlXCIsXHJcbiAgfTsiLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xyXG5pbXBvcnQgeyBTZWN0aW9uIH0gZnJvbSBcIi4uL3NjcmlwdHMvY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XHJcbmltcG9ydCB7IENhcmQgfSBmcm9tIFwiLi4vc2NyaXB0cy9jb21wb25lbnRzL0NhcmQuanNcIjtcclxuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL3NjcmlwdHMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCB7IFBvcHVwRm9ybSB9IGZyb20gXCIuLi9zY3JpcHRzL2NvbXBvbmVudHMvUG9wdXBGb3JtLmpzXCI7XHJcblxyXG5pbXBvcnQgeyBQb3B1cEltYWdlIH0gZnJvbSBcIi4uL3NjcmlwdHMvY29tcG9uZW50cy9Qb3B1cEltYWdlLmpzXCI7XHJcblxyXG5pbXBvcnQgeyBVc2VySW5mbyB9IGZyb20gXCIuLi9zY3JpcHRzL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcclxuXHJcbmltcG9ydCB7IEFwaSB9IGZyb20gXCIuLi9zY3JpcHRzL2NvbXBvbmVudHMvQXBpLmpzXCI7XHJcblxyXG5pbXBvcnQge1xyXG4gIGZvcm1Db25maWcsXHJcbiAgZm9ybUFkZCxcclxuICBmb3JtRWRpdCxcclxuICBmb3JtQXZhdGFyLFxyXG4gIGFkZFBvcHVwRWxlbWVudCxcclxuICBlZGl0UG9wdXBFbGVtZW50LFxyXG4gIGF2YXRhclBvcHVwRWxlbWVudCxcclxuICBidXR0b25BZGQsXHJcbiAgYnV0dG9uRWRpdCxcclxuICBuYW1lSW5wdXQsXHJcbiAgam9iSW5wdXQsXHJcbiAgcG9wdXBJbWFnZSxcclxuICBhdmF0YXJJbnB1dCxcclxuICBwcm9maWxlUGljLFxyXG59IGZyb20gXCIuLi9zY3JpcHRzL3V0aWxzL2NvbnN0YW50cy5qc1wiO1xyXG5cclxuLy9pbml0aWFsaXppbmcgYXBpXHJcblxyXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcclxuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvY29ob3J0LTMtZW5cIixcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcImI0NTEyOTRiLTQ0ZDktNDY0YS04ODc0LTJkNDEzN2E0ZWIzY1wiLFxyXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcclxuICB9XHJcbn0pO1xyXG5cclxubGV0IHVzZXJJZDtcclxuXHJcbi8vZ2V0dGluZyBpbml0aWFsIGNhcmRzIGFuZCBwcm9maWxlIGluZm9cclxuXHJcblByb21pc2UuYWxsKFthcGkuZ2V0VXNlckluZm8oKSwgYXBpLmdldEluaXRpYWxDYXJkcygpXSlcclxuICAudGhlbigoW2NhcmREYXRhLCB1c2VyRGF0YV0pID0+IHtcclxuICAgIHVzZXJJZCA9IHVzZXJEYXRhLmlkO1xyXG4gICAgdXNlckluZm8uc2V0VXNlckluZm8odXNlckRhdGEubmFtZSwgdXNlckRhdGEuYWJvdXQpO1xyXG4gICAgdXNlckluZm8uc2V0VXNlckltYWdlKHVzZXJEYXRhLmF2YXRhcik7XHJcblxyXG4gICAgY2FyZExpc3QucmVuZGVySXRlbXMoY2FyZERhdGEpO1xyXG4gIH0pXHJcbiAgLmNhdGNoKChlcnIpID0+IHtjb25zb2xlLmxvZyhlcnIpfSlcclxuXHJcbi8vc3VibWl0dGluZyBjYXJkXHJcblxyXG5jb25zdCBzdWJtaXRDYXJkID0gKGRhdGEpID0+IHtcclxuXHJcbmNvbnN0IG5ld0ltYWdlID0ge1xyXG4gIHRpdGxlOiBkYXRhWyd0aXRsZSddLFxyXG4gIGxpbms6IGRhdGFbJ2xpbmsnXVxyXG59O1xyXG5jYXJkTGlzdC5hZGRJdGVtKG5ld0ltYWdlKTtcclxuXHJcbmNhcmRGb3JtLmNsb3NlKCk7XHJcblxyXG59XHJcblxyXG4vL3N1Ym1pdHRpbmcgcHJvZmlsZVxyXG5cclxuY29uc3Qgc3VibWl0UHJvZmlsZSA9IChkYXRhKSA9PiB7XHJcbiAgdXNlckluZm8uc2V0VXNlckluZm8oZGF0YS5uYW1lLCBkYXRhLmRlc2NyaXB0aW9uKVxyXG5cclxuICBwcm9maWxlRm9ybS5jbG9zZSgpXHJcbn1cclxuXHJcbi8vc3VibWl0dGluZyBwcm9maWxlIHBpY1xyXG5cclxuY29uc3Qgc3VibWl0QXZhdGFyID0gKGRhdGEpID0+IHtcclxuICB1c2VySW5mby5zZXRVc2VySW1hZ2UoZGF0YS5waWN0dXJlKVxyXG5cclxuICBhdmF0YXJGb3JtLmNsb3NlKClcclxufVxyXG5cclxuLy9kaXNwbGF5aW5nIGNhcmRzIGluIGdhbGxlcnlcclxuXHJcbmNvbnN0IGNhcmRMaXN0ID0gbmV3IFNlY3Rpb24oXHJcbiAge1xyXG4gICAgLy9pdGVtczogaW5pdGlhbENhcmRzLFxyXG4gICAgcmVuZGVyZXI6IHJlbmRlckNhcmQsXHJcbiAgfSxcclxuICBcIi5ncmlkX19jYXJkc1wiXHJcbik7XHJcblxyXG5jYXJkTGlzdC5yZW5kZXJJdGVtcygpO1xyXG5cclxuLy91c2VyIGluZm8gc2VjdGlvblxyXG5cclxuY29uc3QgcHJvZmlsZUZvcm0gPSBuZXcgUG9wdXBGb3JtKGVkaXRQb3B1cEVsZW1lbnQsIHN1Ym1pdFByb2ZpbGUpXHJcbnByb2ZpbGVGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG4vL2NhcmQgc2VjdGlvblxyXG5cclxuY29uc3QgY2FyZEZvcm0gPSBuZXcgUG9wdXBGb3JtKGFkZFBvcHVwRWxlbWVudCwgc3VibWl0Q2FyZClcclxuY2FyZEZvcm0uc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbi8vaW1hZ2Ugc2VjdGlvblxyXG5cclxuY29uc3QgaW1hZ2VNb2R1bGUgPSBuZXcgUG9wdXBJbWFnZShwb3B1cEltYWdlKTtcclxuaW1hZ2VNb2R1bGUuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbi8vYXZhdGFyIHNlY3Rpb25cclxuXHJcbmNvbnN0IGF2YXRhckZvcm0gPSBuZXcgUG9wdXBGb3JtKGF2YXRhclBvcHVwRWxlbWVudCwgc3VibWl0QXZhdGFyKTtcclxuYXZhdGFyRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuXHJcbi8vYWRkaW5nIGNhcmQgdG8gZ2FsbGVyeVxyXG5cclxuZnVuY3Rpb24gcmVuZGVyQ2FyZChjYXJkKSB7XHJcbiAgY29uc3QgaW1hZ2UgPSBuZXcgQ2FyZChjYXJkLCBcIiNjYXJkXCIsICgpID0+IHtcclxuICAgIGltYWdlTW9kdWxlLm9wZW4oY2FyZC50aXRsZSwgY2FyZC5saW5rKTtcclxuICB9KTtcclxuICByZXR1cm4gaW1hZ2UuZ2VuZXJhdGVDYXJkKCk7XHJcbn1cclxuXHJcblxyXG4vL2dldHRpbmcgdGhlIGN1cnJlbnQgdXNlciBpbmZvXHJcblxyXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XHJcbiAgZnVsbE5hbWU6IFwiLnByb2ZpbGVfX25hbWVcIixcclxuICBjYXRlZ29yeTogXCIucHJvZmlsZV9fY2F0ZWdvcnlcIixcclxuICBwcm9maWxlUGljOiBcIi5wcm9maWxlX19waWN0dXJlXCJcclxufSk7XHJcblxyXG5mdW5jdGlvbiByZW5kZXJQcm9maWxlKCl7XHJcbiAgY29uc3QgcHJvZmlsZSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XHJcblxyXG4gIG5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGUubmFtZVxyXG4gIGpvYklucHV0LnZhbHVlID0gcHJvZmlsZS5kZXNjcmlwdGlvbjtcclxuICBcclxuICBlZGl0Rm9ybVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb25FcnJvcigpO1xyXG4gIHByb2ZpbGVGb3JtLm9wZW4oKTtcclxufVxyXG5cclxuZnVuY3Rpb24gcmVuZGVyQXZhdGFyKCl7XHJcbiAgY29uc3QgcHJvZmlsZSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XHJcbiAgYXZhdGFySW5wdXQudmFsdWUgPSBwcm9maWxlLnBpY3R1cmU7XHJcblxyXG4gIGF2YXRhckZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uRXJyb3IoKTtcclxuICBhdmF0YXJGb3JtLm9wZW4oKTtcclxufVxyXG5cclxuXHJcbi8vaGFuZGxlcnNcclxuXHJcbmJ1dHRvbkVkaXQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHJlbmRlclByb2ZpbGUpO1xyXG5cclxuYnV0dG9uQWRkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgYWRkRm9ybVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb25FcnJvcigpO1xyXG4gIGNhcmRGb3JtLm9wZW4oKTtcclxufSk7XHJcblxyXG5wcm9maWxlUGljLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCByZW5kZXJBdmF0YXIpXHJcblxyXG5cclxuLy92YWxpZGF0b3Igc2V0dGluZ3NcclxuXHJcbmNvbnN0IGVkaXRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUNvbmZpZywgZm9ybUVkaXQpO1xyXG5jb25zdCBhZGRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUNvbmZpZywgZm9ybUFkZCk7XHJcbmNvbnN0IGF2YXRhckZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihmb3JtQ29uZmlnLCBmb3JtQXZhdGFyKTtcclxuXHJcbmVkaXRGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuYWRkRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbmF2YXRhckZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpOyIsImV4cG9ydCBjbGFzcyBTZWN0aW9uIHtcclxuICBjb25zdHJ1Y3Rvcih7ICByZW5kZXJlciB9LCAgY29udGFpbmVyU2VsZWN0b3IpIHtcclxuICAgIC8vdGhpcy5faXRlbXMgPSBpdGVtcztcclxuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XHJcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIC8vIGluc2VydHMgZWxlbWVudCB0byB0aGUgY29udGFpbmVyXHJcbiAgYWRkSXRlbShkYXRhKSB7XHJcbiAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5fcmVuZGVyZXIoZGF0YSlcclxuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpXHJcbiAgfTtcclxuXHJcbiAgLy8gcmVuZGVycyBpbml0aWFsIGl0ZW1zXHJcbiAgcmVuZGVySXRlbXMoaXRlbXMpIHtcclxuICAgIGl0ZW1zLmZvckVhY2goKGRhdGEpID0+IHtcclxuICAgICAgdGhpcy5hZGRJdGVtKGRhdGEpXHJcbiAgICB9KVxyXG4gIH07XHJcbn0iLCJpbXBvcnQgeyBQb3B1cCB9IGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgUG9wdXBJbWFnZSBleHRlbmRzIFBvcHVwe1xyXG4gICAgY29uc3RydWN0b3IocG9wdXBFbGVtZW50KXtcclxuICAgICAgICBzdXBlcihwb3B1cEVsZW1lbnQpO1xyXG5cclxuICAgICAgICB0aGlzLl9pbWFnZVRpdGxlID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaW1hZ2VfX3RpdGxlXCIpO1xyXG4gICAgICAgIHRoaXMuX2ltYWdlUHJldmlldyA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmltYWdlX19maWxlXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIG9wZW4odGl0bGUsIGxpbmspe1xyXG4gICAgXHJcbiAgICAgICAgc3VwZXIub3BlbigpXHJcbiAgICB0aGlzLl9pbWFnZVByZXZpZXcuc3JjID0gbGluaztcclxuICAgIHRoaXMuX2ltYWdlUHJldmlldy5hbHQgPSB0aXRsZTtcclxuICAgIHRoaXMuX2ltYWdlVGl0bGUudGV4dENvbnRlbnQgPSB0aXRsZTtcclxuXHJcbiBcclxuICAgIH1cclxufSIsImV4cG9ydCBjbGFzcyBVc2VySW5mbyB7XHJcbiAgICBjb25zdHJ1Y3Rvcih7IGZ1bGxOYW1lLCBjYXRlZ29yeSwgcHJvZmlsZVBpYyB9KSB7XHJcbiAgICAgIHRoaXMuX2Z1bGxOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihmdWxsTmFtZSk7XHJcbiAgICAgIHRoaXMuX2NhdGVnb3J5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihjYXRlZ29yeSk7XHJcbiAgICAgIHRoaXMuX3Byb2ZpbGVQaWMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHByb2ZpbGVQaWMpO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgbmFtZTogdGhpcy5fZnVsbE5hbWUudGV4dENvbnRlbnQsXHJcbiAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuX2NhdGVnb3J5LnRleHRDb250ZW50LFxyXG4gICAgICAgIHBpY3R1cmU6IHRoaXMuX3Byb2ZpbGVQaWMuc3JjXHJcbiAgICAgIH1cclxuICAgIH1cclxuICBcclxuICAgIHNldFVzZXJJbmZvKCBuYW1lLCBkZXNjcmlwdGlvbiApIHtcclxuICAgICAgdGhpcy5fZnVsbE5hbWUudGV4dENvbnRlbnQgPSBuYW1lO1xyXG4gICAgICB0aGlzLl9jYXRlZ29yeS50ZXh0Q29udGVudCA9IGRlc2NyaXB0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFVzZXJJbWFnZShwaWN0dXJlKXtcclxuICAgICAgdGhpcy5fcHJvZmlsZVBpYy5zcmMgPSBwaWN0dXJlO1xyXG4gICAgfVxyXG5cclxuICB9XHJcbiAgIl0sIm5hbWVzIjpbIkNhcmQiLCJjb25zdHJ1Y3RvciIsImRhdGEiLCJjYXJkU2VsZWN0b3IiLCJoYW5kbGVDYXJkQ2xpY2siLCJldnQiLCJ0YXJnZXQiLCJjbGFzc0xpc3QiLCJ0b2dnbGUiLCJ0aGlzIiwiX2VsZW1lbnQiLCJyZW1vdmUiLCJfZGF0YSIsIl90aXRsZSIsInRpdGxlIiwiX2xpbmsiLCJsaW5rIiwiX2NhcmRTZWxlY3RvciIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfZ2V0VGVtcGxhdGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiZ2VuZXJhdGVDYXJkIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiY2FyZEltYWdlIiwiY2FyZFRpdGxlIiwic3R5bGUiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJ0ZXh0Q29udGVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJfcHJlc3NMaWtlIiwiX3ByZXNzRGVsZXRlIiwiY29uZmlnIiwiZm9ybUVsZW1lbnQiLCJpbnB1dEVsZW1lbnQiLCJlcnJvck1lc3NhZ2UiLCJlcnJvckVsZW1lbnQiLCJpZCIsImFkZCIsIl9pbnB1dEVycm9yQ2xhc3MiLCJfZXJyb3JDbGFzcyIsInZhbGlkaXR5IiwidmFsaWQiLCJfaGlkZUlucHV0RXJyb3IiLCJfc2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIl9oYXNJbnZhbGlkSW5wdXQiLCJfaW5wdXRMaXN0IiwiX2J1dHRvbkVsZW1lbnQiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsImRpc2FibGVkIiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX2ZpZWxkc2V0U2VsZWN0b3IiLCJmaWVsZHNldFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJyZXNldFZhbGlkYXRpb25FcnJvciIsImZvckVhY2giLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJzb21lIiwicHJldmVudERlZmF1bHQiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwiZW5hYmxlVmFsaWRhdGlvbiIsIlBvcHVwIiwicG9wdXBFbGVtZW50IiwiY3VycmVudFRhcmdldCIsImNsb3NlIiwiX3BvcHVwRWxlbWVudCIsIl9oYW5kbGVFc2NDbG9zZSIsImJpbmQiLCJfaGFuZGxlTGF5b3ZlckNsb3NlIiwia2V5Iiwib3BlbiIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRFdmVudExpc3RlbmVycyIsImNvbnRhaW5zIiwiUG9wdXBGb3JtIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInN1cGVyIiwiX2hhbmRsZUZvcm1TdWJtaXQiLCJfZm9ybUVsZW1lbnQiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJpbnB1dHMiLCJpbnB1dCIsInZhbHVlIiwiZSIsInNldElucHV0VmFsdWVzIiwiX2lucHV0cyIsIm5hbWUiLCJyZXNldCIsImZldGNoZXIiLCJ1cmwiLCJoZWFkZXIiLCJmZXRjaCIsInRoZW4iLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwicHJvZmlsZVBpYyIsInBvcHVwSW1hZ2UiLCJidXR0b25FZGl0IiwiZ2V0RWxlbWVudEJ5SWQiLCJmb3JtRWRpdCIsImZvcm1BdmF0YXIiLCJlZGl0UG9wdXBFbGVtZW50IiwiYWRkUG9wdXBFbGVtZW50IiwiYXZhdGFyUG9wdXBFbGVtZW50IiwibmFtZUlucHV0Iiwiam9iSW5wdXQiLCJhdmF0YXJJbnB1dCIsImJ1dHRvbkFkZCIsImZvcm1BZGQiLCJmb3JtQ29uZmlnIiwiZm9ybVNlbGVjdG9yIiwiYXBpIiwiYmFzZVVybCIsImhlYWRlcnMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0SW5pdGlhbENhcmRzIiwiYWRkQ2FyZCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0VXNlckluZm8iLCJhdXRob3JpemF0aW9uIiwidXNlcklkIiwiYWxsIiwiY2FyZERhdGEiLCJ1c2VyRGF0YSIsInVzZXJJbmZvIiwic2V0VXNlckluZm8iLCJhYm91dCIsInNldFVzZXJJbWFnZSIsImF2YXRhciIsImNhcmRMaXN0IiwicmVuZGVySXRlbXMiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJjb250YWluZXJTZWxlY3RvciIsInJlbmRlcmVyIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsImFkZEl0ZW0iLCJlbGVtZW50IiwicHJlcGVuZCIsIml0ZW1zIiwiY2FyZCIsImltYWdlTW9kdWxlIiwicHJvZmlsZUZvcm0iLCJkZXNjcmlwdGlvbiIsImNhcmRGb3JtIiwibmV3SW1hZ2UiLCJfaW1hZ2VUaXRsZSIsIl9pbWFnZVByZXZpZXciLCJzcmMiLCJhbHQiLCJhdmF0YXJGb3JtIiwicGljdHVyZSIsImZ1bGxOYW1lIiwiY2F0ZWdvcnkiLCJfZnVsbE5hbWUiLCJfY2F0ZWdvcnkiLCJfcHJvZmlsZVBpYyIsInByb2ZpbGUiLCJlZGl0Rm9ybVZhbGlkYXRvciIsImFkZEZvcm1WYWxpZGF0b3IiLCJhdmF0YXJGb3JtVmFsaWRhdG9yIiwiRm9ybVZhbGlkYXRvciJdLCJzb3VyY2VSb290IjoiIn0=